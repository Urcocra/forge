---
interface Props {
  runId: string;
}

const { runId } = Astro.props;
const command = `npx forge reproduce --id=${runId}`;
---

<div class="flex items-center gap-2">
  <div class="mockup-code flex-grow">
    <pre data-prefix="$"><code>{command}</code></pre>
  </div>
  
  <div class="flex flex-col gap-2">
      <button 
        class="btn btn-sm btn-ghost btn-square" 
        title="Copy to clipboard"
        onclick={`navigator.clipboard.writeText('${command}'); this.innerHTML = '<svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-5 w-5 text-success\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\" /></svg>'; setTimeout(() => this.innerHTML = '<svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-5 w-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\" /></svg>', 2000);`}
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
      </button>

      <button
        id="run-trigger-btn"
        class="btn btn-sm btn-primary btn-square"
        title="Run Reproduction"
        data-run-id={runId}
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
      </button>
  </div>
</div>

<script>
  const btn = document.getElementById('run-trigger-btn');
  if (btn) {
    btn.addEventListener('click', async () => {
      const runId = btn.getAttribute('data-run-id');
      try {
        await fetch('/api/reproduce', {
           method: 'POST',
           headers: { 'Content-Type': 'application/json' },
           body: JSON.stringify({ runId })
        });
        // Visual feedback only (Fire and Forget)
        const original = btn.innerHTML;
        btn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>';
        btn.classList.replace('btn-primary', 'btn-success');
        setTimeout(() => {
           btn.innerHTML = original;
           btn.classList.replace('btn-success', 'btn-primary');
        }, 2000);
      } catch (e) {
        console.error('Failed to trigger reproduce', e);
      }
    });
  }
</script>
